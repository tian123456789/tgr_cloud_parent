############################################################################################################################################
p124

Feign 是一个伪 Java Http 客户端 ， Feign 不做任何的请求处理。 Feign 通过处理注解生成
Request 模板，从而简化了 Http API 的开发。开发人员可以使用注解的方式定制 Request API
模板。在发送 HttpRequest 请求之前 ， Feign 通过处理注解的方式替换掉 Request 模板中的参数，
生成真正的 Request，并交给 Java Http 客户端去处理 。 利用这种方式，开发者只需要关注 Feign
注解模板的开发，而不用关注 Http 请求本身，简化了 Http 请求的过程，使得 Htφ 请求变得简
单和容易理解。
Feign 通过包扫描注入 FeignClient 的 Bean ，该源码在 FeignClientsRegistrar 类中 。首先在
程序启动时，会检查是否有@EnableFeignClients 注解，如果有该注解，则开启包扫描，扫描
被@FeignClient 注解的接口 。
############################################################################################################################################

总的来说 ， Feign 的源码实现过程如下。
( 1) 首先通过@EnableFeignClients 注解开启 FeignClient 的功能。只有这个注解存在，才
会在程序启动时开启对@FeignClient 注解的包扫描 。
(2 ）根据 Feign 的规则实现接口，井在接口上面加上@Feign Client 注解 。
(3 ）程序启动后，会进行包扫描，扫描所有的@Feign Client 的注解 的类 ，并将这些信息
注入 IoC 容器中。
( 4 ）当接口的方法被调用时 ， 通过 JDK 的代理来生成具体的 RequestTemplate 棋根对象 。
( 5 ）根据 RequestTemplate 再生成 Http 请求的 Request 对象 。
( 6 ) Request 对象交给 Client 去处理 ， 其中 Client 的网络请求框架可以是 HttpURLConnection 、
HttpClient 和 OkHttp 。
(7 ）最后 Client 被封装到 LoadBalanceClient 类，这个类结合类 Ribbon 做到了负载均衡 

############################################################################################################################################

Zuul 作为路由网关组件，在微服务架构中有着非常重要的作用，主要体现在以下 6 个方面。
口  Zuul 、 Ribbon 以及 Eureka 相结合，可以实现智能路由和负载均衡的功能， Zuul 能够
将请求流量按某种策略分发到集群状态的多个服务实例。
口 网关将所有服务的 API 接口统一聚合，并统一对外暴露。外界系统调用 API 接口时，
都是由网关对外暴露的 API 接口，外界系统不需要知道微服务系统中各服务相互调
用的复杂性。微服务系统也保护了其内部微服务单元的 API 接口 ， 防止其被外界直
接调用，导致服务的敏感信息对外暴露。
口 网关服务可以做用户身份认证和权限认证，防止非法请求操作 API 接口，对服务器
起到保护作用。
口 网关可以实现监控功能，实时日志输出，对请求进行记录。
口 网关可以用来实现流量监控 ， 在高流量的情况下，对服务进行降级。
口 API 接口从内部服务分离出来 ， 方便做测试。
############################################################################################################################################

Zuul 是通过 Servlet 来实现的， Zuul 通过自定义的 ZuulServlet （类似于 Spring MVC 的
DispatcServlet 〕来对请求进行控制。 Zuul 的核心是一系列过滤器，可以在 Http 请求的发起和
响应返回期间执行一系列的过滤器。 Zuul 包括以下 4 种过滤器 。
口 PRE 过滤器 ： 它是在请求路由到具体的服务之前执行的，这种类型的过滤器可 以做
安全验证，例如身份验证、 参数验证等。
口 ROUTING 过滤器 ： 它用于将请求路由到具体的微服务实例 。在默认情况下 ，它使用
Http Client 进行网络请求。
口 POST 过滤器：它是在请求己被路由到微服务后执行的 。 一般情况下，用作收集统计
信息、指标，以及将响应传输到客户端 。
口 ERROR 过滤器：它是在其他过滤器发生错误时执行的 。

Zuul 请求的生命周期如图 9-1 所示 ，该图来自 Zuul 的官方文档 。
当一个客户端 Request 请求进入 Zuul 网关服务时，网关先进入“ pre filter飞进行一系列
的验证、操作或者判断 。 然后交给“routing filter”进行路由转发，转发到具体的服务实例进
行逻辑处理、返回数据。当具体的服务处理完后，最后由“post filter，，进行处理， 该类型的处
理器处理完之后，将 Response 信息返回给客户端。

ZuulServlet 是 Zuul 的核心 Servlet 。 ZuulServlet 的作用是初始化 ZuulFilter ， 并编排这些
ZuulFilter 的执行顺序。该类中有一个 service （）方法 ，执行了过滤器执行的逻辑 。

############################################################################################################################################

