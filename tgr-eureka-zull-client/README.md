
############################################################################################################################################

Zuul 作为路由网关组件，在微服务架构中有着非常重要的作用，主要体现在以下 6 个方面。
口  Zuul 、 Ribbon 以及 Eureka 相结合，可以实现智能路由和负载均衡的功能， Zuul 能够
将请求流量按某种策略分发到集群状态的多个服务实例。
口 网关将所有服务的 API 接口统一聚合，并统一对外暴露。外界系统调用 API 接口时，
都是由网关对外暴露的 API 接口，外界系统不需要知道微服务系统中各服务相互调
用的复杂性。微服务系统也保护了其内部微服务单元的 API 接口 ， 防止其被外界直
接调用，导致服务的敏感信息对外暴露。
口 网关服务可以做用户身份认证和权限认证，防止非法请求操作 API 接口，对服务器
起到保护作用。
口 网关可以实现监控功能，实时日志输出，对请求进行记录。
口 网关可以用来实现流量监控 ， 在高流量的情况下，对服务进行降级。
口 API 接口从内部服务分离出来 ， 方便做测试。
############################################################################################################################################

Zuul 是通过 Servlet 来实现的， Zuul 通过自定义的 ZuulServlet （类似于 Spring MVC 的
DispatcServlet 〕来对请求进行控制。 Zuul 的核心是一系列过滤器，可以在 Http 请求的发起和
响应返回期间执行一系列的过滤器。 Zuul 包括以下 4 种过滤器 。
口 PRE 过滤器 ： 它是在请求路由到具体的服务之前执行的，这种类型的过滤器可 以做
安全验证，例如身份验证、 参数验证等。
口 ROUTING 过滤器 ： 它用于将请求路由到具体的微服务实例 。在默认情况下 ，它使用
Http Client 进行网络请求。
口 POST 过滤器：它是在请求己被路由到微服务后执行的 。 一般情况下，用作收集统计
信息、指标，以及将响应传输到客户端 。
口 ERROR 过滤器：它是在其他过滤器发生错误时执行的 。

Zuul 请求的生命周期如图 9-1 所示 ，该图来自 Zuul 的官方文档 。
当一个客户端 Request 请求进入 Zuul 网关服务时，网关先进入“ pre filter飞进行一系列
的验证、操作或者判断 。 然后交给“routing filter”进行路由转发，转发到具体的服务实例进
行逻辑处理、返回数据。当具体的服务处理完后，最后由“post filter，，进行处理， 该类型的处
理器处理完之后，将 Response 信息返回给客户端。

ZuulServlet 是 Zuul 的核心 Servlet 。 ZuulServlet 的作用是初始化 ZuulFilter ， 并编排这些
ZuulFilter 的执行顺序。该类中有一个 service （）方法 ，执行了过滤器执行的逻辑 。

############################################################################################################################################
Zuul 是采用了类似于 Spring MVC 的 DispatchServlet 来实现的，采用的是异步阻塞模型，
所以性能比 Ngnix 差。由于 Zuul 和其他 Netflix 组件可以相互配合、无缝集成 ， Zuul 很容易
就能实现负载均衡、智能路由和熔断器等功能。在大多数情况下 ， Zuul 都是以集群的形式存
在的。由于 Zu川的横向扩展能力非常好，所以当负载过高时，可以通过添加实例来解决性
能瓶颈。
一种常见的使用方式是对不同的渠道使用不同的 Zuul 来进行路由，例如移动端共用一个
Zuul 网关实例 ， Web 端用另 一个 Zuul 网关实例，其他的客户端用另外一个 Zuul 实例进行路由 。
这种不同的渠边用不同 Zuul 实例的架构如图 9-3 所示。
另外一种常见的集群是通过 Ngnix 和 Zuul 相互结合来做负载均衡。暴露在最外面的是
Ngnix 主从双热备进行 Keepalive, Ngnix 经过某种路由策略，将请求路由转发到 Zuul 集群上，
Zuul 最终将请求分发到具体的服务上
